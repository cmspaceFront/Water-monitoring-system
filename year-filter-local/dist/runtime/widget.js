/*! For license information please see widget.js.LICENSE.txt */
System.register(["jimu-core","jimu-core/react-dom","jimu-core/react"],(function(e,t){var o={},r={},n={};return{setters:[function(e){o.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,o.DataSourceComponent=e.DataSourceComponent,o.MessageManager=e.MessageManager,o.StringSelectionChangeMessage=e.StringSelectionChangeMessage,o.jsx=e.jsx},function(e){r.default=e.default},function(e){n.createElement=e.createElement,n.forwardRef=e.forwardRef,n.useEffect=e.useEffect,n.useRef=e.useRef,n.useState=e.useState}],execute:function(){e((()=>{var e={79244:e=>{"use strict";e.exports=o},68972:e=>{"use strict";e.exports=n},22581:e=>{"use strict";e.exports=r}},t={};function a(o){var r=t[o];if(void 0!==r)return r.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,a),n.exports}a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="";var i={};return a.p=window.jimuConfig.baseUrl,(()=>{"use strict";a.r(i),a.d(i,{__set_webpack_public_path__:()=>S,default:()=>x});var e=a(79244),t=a(22581),o=a(68972);const r=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,((e,t,o)=>o?o.toUpperCase():t.toLowerCase())))(e);return t.charAt(0).toUpperCase()+t.slice(1)},n=(...e)=>e.filter(((e,t,o)=>Boolean(e)&&""!==e.trim()&&o.indexOf(e)===t)).join(" ").trim(),s=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const c=(0,o.forwardRef)((({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:i="",children:c,iconNode:d,...u},f)=>(0,o.createElement)("svg",{ref:f,...l,width:t,height:t,stroke:e,strokeWidth:a?24*Number(r)/Number(t):r,className:n("lucide",i),...!c&&!s(u)&&{"aria-hidden":"true"},...u},[...d.map((([e,t])=>(0,o.createElement)(e,t))),...Array.isArray(c)?c:[c]]))),d=(e,t)=>{const a=(0,o.forwardRef)((({className:a,...i},s)=>{return(0,o.createElement)(c,{ref:s,iconNode:t,className:n(`lucide-${l=r(e),l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,a),...i});var l}));return a.displayName=r(e),a},u=d("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),f=d("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),g=d("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var p=function(e,t,o,r){return new(o||(o=Promise))((function(n,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))};function h(){try{return"dark"===localStorage.getItem("customTheme")?"dark":"light"}catch(e){return"light"}}function m(e,t){var o,r;return e&&e&&"object"==typeof e&&(e.light||e.dark)?null!==(r=null!==(o=e[t])&&void 0!==o?o:e.light)&&void 0!==r?r:e.dark:e}const v="selected-year";function w(e){const t=localStorage.getItem("custom_locale")||"ru";if(null==e?void 0:e.translations){if("ru"===t&&e.translations.ru)return e.translations.ru;if("uz"===t&&e.translations.uz)return e.translations.uz;if("uzcryl"===t&&e.translations.uzcryl)return e.translations.uzcryl}return"ru"===t?"\u0412\u0441\u0435 \u0433\u043e\u0434\u044b":"uz"===t?"Barcha yillar":"uzcryl"===t?"\u04b2\u0430\u043c\u043c\u0430\u0441\u0438":"All"}function x(r){var n;const a=null===(n=r.useDataSources)||void 0===n?void 0:n[0],i=r.config,s=i.yearField||"made_year",l=i.placeholder||"Year",[c,d]=(0,o.useState)(),[x,S]=(0,o.useState)([]),[y,b]=(0,o.useState)([]),[C,I]=(0,o.useState)(function(e){const t=localStorage.getItem(v);return t&&"All"!==t?t:w(e)}(i)),[k,M]=(0,o.useState)(!1),[j,F]=(0,o.useState)("default"),[R,z]=(0,o.useState)(null),[A,B]=(0,o.useState)({left:0,top:0,width:0}),[E,P]=(0,o.useState)(h()),[_,D]=(0,o.useState)(0),[L,W]=(0,o.useState)(!1),[N,T]=(0,o.useState)(localStorage.getItem("custom_locale")||"ru"),$=(0,o.useRef)(null);(0,o.useEffect)((()=>{let e=h(),t=localStorage.getItem("custom_locale")||"ru";const o=e=>{if("customTheme"===e.key){const e=h();P(e),D((e=>e+1))}if("custom_locale"===e.key){const o=e.newValue||"ru";if(o!==t){t=o,T(o);"All"===(localStorage.getItem(v)||"All")&&I(w(i))}}};window.addEventListener("storage",o);const r=setInterval((()=>{const o=h(),r=localStorage.getItem("custom_locale")||"ru";if(o!==e&&(e=o,P(o),D((e=>e+1))),r!==t){t=r,T(r);"All"===(localStorage.getItem(v)||"All")&&I(w(i))}}),100);return()=>{window.removeEventListener("storage",o),clearInterval(r)}}),[]),(0,o.useEffect)((()=>{"All"===(localStorage.getItem(v)||"All")&&I(w(i))}),[i]),(0,o.useEffect)((()=>{c&&O()}),[c]),(0,o.useEffect)((()=>{if(x.length){const e=Array.from(new Set(x.map((e=>e.getFieldValue(s))).filter(Boolean))).sort(((e,t)=>Number(t)-Number(e)));b([w(i),...e.filter((e=>e!==w(i)))]),e.includes(C)||C===w(i)||I(w(i))}}),[x,N,i]),(0,o.useEffect)((()=>{if(!C)return;let t=C;(L||C===w(i))&&(t="All",W(!1)),localStorage.setItem(v,t),i.sessionStorageKey&&sessionStorage.setItem(i.sessionStorageKey,t);const o=new e.StringSelectionChangeMessage(r.id,t);o.str=t,e.MessageManager.getInstance().publishMessage(o)}),[C,L]);const O=()=>p(this,void 0,void 0,(function*(){if(!c||!r.id)return;const e={where:"1=1",outFields:["*"],returnGeometry:!0};try{const t=yield c.query(e,{widgetId:r.id});S(t.records||[])}catch(e){console.error("\u274c Load failed:",e)}})),H=(e,t)=>{var o;return null!==(o=m(e,E))&&void 0!==o?o:t};function U(e){const t=e===C,o=R===e;let r={textAlign:"center",cursor:"pointer",fontSize:H(i.dropdownItemFontSize)||"19px",padding:H(i.dropdownItemPadding)||"10px 0",borderRadius:H(i.dropdownItemBorderRadius)||"12px",margin:"0 8px",fontWeight:t?H(i.dropdownItemFontWeight)||700:H(i.dropdownItemFontWeight)||500,transition:"background 0.15s, color 0.15s, border 0.15s"};return t?(r.color=H(i.dropdownItemActiveTextColor,"#2264e5"),r.background=H(i.dropdownItemActiveBgColor,"#F2F7FF"),r.border=`1.5px solid ${H(i.dropdownItemActiveBorderColor,"transparent")}`):o?(r.color=H(i.dropdownItemHoverTextColor,"#2264e5"),r.background=H(i.dropdownItemHoverBgColor,"#F5F5F6"),r.border=`1.5px solid ${H(i.dropdownItemHoverBorderColor,"transparent")}`):(r.color=H(i.dropdownItemTextColor,"#181923"),r.background=H(i.dropdownItemBgColor,"#fff"),r.border=`1.5px solid ${H(i.dropdownItemBorderColor,"transparent")}`),r}const V=function(e){let t,o,r;return"active"===e?(t=H(i.activeBgColor,H(i.bgColor,"#F5F5F6")),o=H(i.activeTextColor,H(i.textColor,"#181923")),r=H(i.activeBorderColor,H(i.borderColor,"#f1f1f4"))):"hover"===e?(t=H(i.hoverBgColor,H(i.bgColor,"#F5F5F6")),o=H(i.hoverTextColor,H(i.textColor,"#181923")),r=H(i.hoverBorderColor,H(i.borderColor,"#f1f1f4"))):(t=H(i.defaultBgColor,H(i.bgColor,"#F5F5F6")),o=H(i.defaultTextColor,H(i.textColor,"#181923")),r=H(i.defaultBorderColor,H(i.borderColor,"#f1f1f4"))),{bg:t,color:o,borderColor:r}}(j),Y=H(V.color),q=(()=>{var t;return!1===i.showIcon?null:(0,e.jsx)(u,{size:(null===(t=i.iconSize)||void 0===t?void 0:t.width)||22,style:{color:Y,marginRight:"right"===i.iconPosition?0:8,marginLeft:"right"===i.iconPosition?8:0,flexShrink:0,transition:"color 0.18s"}})})();(0,o.useEffect)((()=>{if(k)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e);function e(e){$.current&&!$.current.contains(e.target)&&(M(!1),F("default"))}}),[k]);const K=k&&t.default.createPortal((0,e.jsx)("div",{style:{position:"fixed",left:A.left,top:A.top,width:A.width,background:H(i.dropdownItemBgColor,"#fff"),boxShadow:H(i.boxShadow,"0 6px 24px #0002"),borderRadius:H(i.borderRadius)||"12px",zIndex:9999,padding:"8px 0",marginTop:"8px",maxHeight:220,overflowY:"auto",overflowX:"hidden"},onMouseDown:e=>e.stopPropagation()},y.map((t=>(0,e.jsx)("div",{style:U(t),key:t,onMouseEnter:()=>z(t),onMouseLeave:()=>z(null),onMouseDown:e=>e.stopPropagation(),onClick:()=>{if(t===w(i)&&W(!0),I(t),M(!1),F("default"),c)if(t===w(i)){c.updateQueryParams({},r.id),c.selectRecords({records:x.filter((e=>{var t;return null===(t=e.feature)||void 0===t?void 0:t.geometry})),widgetId:r.id});const t=new e.DataRecordsSelectionChangeMessage(r.id,x.filter((e=>{var t;return null===(t=e.feature)||void 0===t?void 0:t.geometry})),[c.id]);e.MessageManager.getInstance().publishMessage(t)}else{const o=x.filter((e=>{var o;return e.getFieldValue(s)===t&&(null===(o=e.feature)||void 0===o?void 0:o.geometry)}));c.updateQueryParams({},r.id),c.selectRecords({records:o,widgetId:r.id});const n=new e.DataRecordsSelectionChangeMessage(r.id,o,[c.id]);e.MessageManager.getInstance().publishMessage(n)}}},t)))),document.body);return(0,e.jsx)("div",{style:{width:i.width||"100%",height:i.height||"100%",position:"relative",background:"transparent",borderRadius:H(i.borderRadius)||"16px",display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"stretch"}},(0,e.jsx)(e.DataSourceComponent,{useDataSource:a,widgetId:r.id,onDataSourceCreated:e=>d(e)}),(0,e.jsx)("div",{style:{width:"100%",height:"100%",background:V.bg,color:V.color,border:V.borderColor?`${H(i.borderWidth)||"1.5px"} ${H(i.borderStyle)||"solid"} ${V.borderColor}`:"none",borderRadius:H(i.borderRadius)||"16px",display:"flex",alignItems:"center",cursor:"pointer",fontWeight:H(i.fontWeight)||500,fontSize:H(i.fontSize)||"18px",padding:H(i.padding)||"0 18px",transition:"background 0.16s, color 0.16s, border 0.16s",boxShadow:H(i.boxShadow)},onClick:function(e){if(!$.current)return;const t=$.current.getBoundingClientRect();B({left:t.left,top:t.bottom+window.scrollY,width:t.width}),M((e=>!e)),F("active")},onMouseEnter:function(){F(k?"active":"hover")},onMouseLeave:function(){F(k?"active":"default")},onMouseDown:function(){F("active")},onMouseUp:function(){F("hover")},ref:$},"right"!==i.iconPosition&&q,(0,e.jsx)("span",{style:{color:V.color,fontWeight:H(i.fontWeight)||500,fontSize:H(i.fontSize)||"18px",transition:"color 0.18s",flex:1,textAlign:"right"===i.iconPosition&&q?"left":"center"}},C||l),"right"===i.iconPosition&&q,(0,e.jsx)("span",{style:{marginLeft:"right"===i.iconPosition&&q?"8px":"auto",color:V.color}},k?(0,e.jsx)(f,{size:24,color:V.color}):(0,e.jsx)(g,{size:24,color:V.color}))),K)}function S(e){a.p=e}})(),i})())}}}));