/*! For license information please see widget.js.LICENSE.txt */
System.register(["jimu-core","jimu-core/react-dom","jimu-core/react"],(function(e,t){var r={},o={},n={};return{setters:[function(e){r.DataSourceComponent=e.DataSourceComponent,r.MessageManager=e.MessageManager,r.StringSelectionChangeMessage=e.StringSelectionChangeMessage,r.jsx=e.jsx},function(e){o.default=e.default},function(e){n.createElement=e.createElement,n.forwardRef=e.forwardRef,n.useEffect=e.useEffect,n.useRef=e.useRef,n.useState=e.useState}],execute:function(){e((()=>{var e={79244:e=>{"use strict";e.exports=r},68972:e=>{"use strict";e.exports=n},22581:e=>{"use strict";e.exports=o}},t={};function l(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,l),n.exports}l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var i={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(i),l.d(i,{__set_webpack_public_path__:()=>C,default:()=>y});var e=l(79244),t=l(22581),r=l(68972);const o=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,((e,t,r)=>r?r.toUpperCase():t.toLowerCase())))(e);return t.charAt(0).toUpperCase()+t.slice(1)},n=(...e)=>e.filter(((e,t,r)=>Boolean(e)&&""!==e.trim()&&r.indexOf(e)===t)).join(" ").trim(),a=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const u=(0,r.forwardRef)((({color:e="currentColor",size:t=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:i="",children:u,iconNode:c,...d},f)=>(0,r.createElement)("svg",{ref:f,...s,width:t,height:t,stroke:e,strokeWidth:l?24*Number(o)/Number(t):o,className:n("lucide",i),...!u&&!a(d)&&{"aria-hidden":"true"},...d},[...c.map((([e,t])=>(0,r.createElement)(e,t))),...Array.isArray(u)?u:[u]]))),c=((e,t)=>{const l=(0,r.forwardRef)((({className:l,...i},a)=>{return(0,r.createElement)(u,{ref:a,iconNode:t,className:n(`lucide-${s=o(e),s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,l),...i});var s}));return l.displayName=o(e),l})("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);var d=function(e,t,r,o){return new(r||(r=Promise))((function(n,l){function i(e){try{s(o.next(e))}catch(e){l(e)}}function a(e){try{s(o.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}s((o=o.apply(e,t||[])).next())}))};const f={SELECTED_YEAR:"selected-year",SELECTED_DAM:"selected_dam"};function m(e){return localStorage.getItem(e)}function g(e,t){t?localStorage.setItem(e,t):localStorage.removeItem(e)}function p(e,t){const r=function(e){switch(e){case"ru":default:return"title_ru";case"uz":return"title_uz_l";case"uzcryl":return"title_uz_c"}}(t),o=e.getFieldValue(r);return o&&""!==o.trim()?o:e.getFieldValue("dam_name")||"Unknown"}function v(){try{const e=localStorage.getItem("exb_auth");if(e)try{const t=JSON.parse(e);if(t.email)return t.email;if(t.user&&t.user.email)return t.user.email;if(t.username&&t.username.includes("@"))return t.username}catch(e){}const t=Object.keys(localStorage).filter((e=>e.includes("portalApp")||e.includes("portal")||e.includes("token")||e.includes("credential")));for(const e of t)try{const t=localStorage.getItem(e),r=JSON.parse(t||"{}");if(r.email)return r.email}catch(e){continue}const r=Object.keys(localStorage);for(const e of r)try{const t=localStorage.getItem(e);if(t&&(t.includes('"email"')||t.includes("farhodmf")||t.includes("@"))){const e=JSON.parse(t);if(e.email)return e.email}}catch(t){const r=localStorage.getItem(e);if(r&&r.includes("@")&&r.length<100)return r;continue}return null}catch(e){return console.error("\u{1f510} Search widget: Error extracting user email:",e),null}}function h(e,t){if(!t||!e)return!1;const r=e.getFieldValue("allowed_users");if(!r)return!1;return r.split(",").map((e=>e.trim().toLowerCase())).includes(t.toLowerCase())}function w(e,t){return t?e.filter((e=>h(e,t))):[]}function E(e,t,r){if(!r||"All"===r||!t)return e;return e.filter((e=>{const o=e.getFieldValue(t);return o&&o.toString()===r}))}function S(){return"dark"===localStorage.getItem("customTheme")?"dark":"light"}function x(e,t){var r,o;return e&&"object"==typeof e&&(e.light||e.dark)?null!==(o=null!==(r=e[t])&&void 0!==r?r:e.light)&&void 0!==o?o:e.dark:e}function y(o){var n,l,i,a,s,u,y,C,b,_,I;const[T,D]=(0,r.useState)(),[A,k]=(0,r.useState)([]),[L,z]=(0,r.useState)([]),[j,M]=(0,r.useState)([]),[R,F]=(0,r.useState)(""),[N,O]=(0,r.useState)([]),[B,W]=(0,r.useState)(!1),[$,P]=(0,r.useState)(-1),[V,Y]=(0,r.useState)({left:0,top:0,width:0}),[U,q]=(0,r.useState)(null),[K,H]=(0,r.useState)("ru"),[J,G]=(0,r.useState)(!1),[Z,Q]=(0,r.useState)(null),[X,ee]=(0,r.useState)(!0),te=(0,r.useRef)(null),re=(0,r.useRef)(null),oe=(0,r.useRef)(null),[ne,le]=(0,r.useState)(S()),[ie,ae]=(0,r.useState)(0),se=null===(n=o.useDataSources)||void 0===n?void 0:n[0],ue=o.config,ce=ue.damField||"dam_name",de="made_year",fe=ue.placeholder||("ru"===K?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0432\u043e\u0434\u043e\u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430":"uz"===K?"Suv omborining nomini kiriting":"\u0421\u0443\u0432 \u043e\u043c\u0431\u043e\u0440\u0438\u043d\u0438\u043d\u0433 \u043d\u043e\u043c\u0438\u043d\u0438 \u043a\u0438\u0440\u0438\u0442\u0438\u043d\u0433"),[me,ge]=(0,r.useState)(!1),[pe,ve]=(0,r.useState)(!1);(0,r.useEffect)((()=>{!function(){d(this,void 0,void 0,(function*(){ee(!0);try{const e=yield function(){return d(this,arguments,void 0,(function*(e=3,t=1e3){let r=v();if(r)return r;for(let o=1;o<=e;o++)if(yield new Promise((e=>setTimeout(e,t))),r=v(),r)return r;return null}))}(3,1e3);Q(e)}catch(e){console.error("\u{1f510} Search widget: Authentication error:",e),Q(null)}finally{ee(!1)}}))}()}),[]),(0,r.useEffect)((()=>{if(Z||X)return;const e=setInterval((()=>{const t=v();t&&(Q(t),clearInterval(e))}),2e3),t=setTimeout((()=>{clearInterval(e)}),3e4);return()=>{clearInterval(e),clearTimeout(t)}}),[Z,X]),(0,r.useEffect)((()=>{q(m(f.SELECTED_YEAR)||"All"),H(m("custom_locale")||"ru")}),[]);const he=e=>{var t;return null!==(t=x(e,ne))&&void 0!==t?t:"#e5e7eb"},we=(e,t)=>{var r,o,n;return e?null!==(r=x(ue.dropdownActiveIconColor,ne))&&void 0!==r?r:"#2264e5":t?null!==(o=x(ue.dropdownActiveIconColor,ne))&&void 0!==o?o:"#2264e5":null!==(n=x(ue.dropdownIconColor,ne))&&void 0!==n?n:"#181923"},Ee=e=>{const t=e||"All";t!==U&&(q(t),(e&&"All"!==e||!U||"All"===U)&&e!==U&&(q(e),R&&e&&"All"!==e&&A.length>0&&setTimeout((()=>{const t=w(E(A,de,e),Z),r=Array.from(new Set(t.map((e=>e.getFieldValue(ce))).filter(Boolean))),o=m(f.SELECTED_DAM);r.length>0&&o&&!r.includes(o)&&(F(""),g(f.SELECTED_DAM,null))}),100)))};(0,r.useEffect)((()=>{const e=m(f.SELECTED_YEAR),t=m("custom_locale")||"ru";m(f.SELECTED_DAM);q(e&&"All"!==e?e:null),H(t)}),[]),(0,r.useEffect)((()=>{let e,t,r;function o(e){switch(e.key){case f.SELECTED_YEAR:Ee(e.newValue);break;case f.SELECTED_DAM:break;case"custom_locale":H(e.newValue||"ru")}}return window.addEventListener("storage",o),e=setInterval((()=>{const e=m(f.SELECTED_YEAR);e!==U&&Ee(e)}),100),t=setInterval((()=>{m(f.SELECTED_DAM)}),100),r=setInterval((()=>{const e=m("custom_locale")||"ru";e!==K&&H(e)}),100),()=>{window.removeEventListener("storage",o),clearInterval(e),clearInterval(t),clearInterval(r),oe.current&&clearTimeout(oe.current)}}),[U,R,K,J,A,de,ce,Z]),(0,r.useEffect)((()=>{T&&Z&&!X&&Se()}),[T,Z,X]),(0,r.useEffect)((()=>{if(!Z)return void z([]);const e=E(w(A,Z),de,U);z(e)}),[A,U,Z,de]),(0,r.useEffect)((()=>{if(L.length>0){const e=new Map;L.forEach((t=>{const r=t.getFieldValue(ce),o=p(t,K);r&&!e.has(r)&&e.set(r,{damName:r,localizedTitle:o})}));const t=Array.from(e.values()).sort(((e,t)=>e.localizedTitle.localeCompare(t.localizedTitle)));M(t)}else M([])}),[L,ce,U,K]),(0,r.useEffect)((()=>{if(R.trim()){const e=R.trim().toLowerCase(),t=j.filter((t=>t.damName.toLowerCase().includes(e)||t.localizedTitle.toLowerCase().includes(e)));O(t)}else O([]);P(-1)}),[R,j]);const Se=()=>d(this,void 0,void 0,(function*(){if(T&&o.id&&Z)try{const e={where:"1=1",outFields:[ce,de,"title_ru","title_uz_c","title_uz_l","allowed_users",...ue.localField?[ue.localField]:[]],returnGeometry:!0},t=(yield T.query(e,{widgetId:o.id})).records||[],r=function(e){if(!e)return"1=0";const t=e.toLowerCase();return`(\n    LOWER(allowed_users) LIKE '${t},%' OR \n    LOWER(allowed_users) LIKE '%,${t},%' OR \n    LOWER(allowed_users) LIKE '%,${t}' OR \n    LOWER(allowed_users) = '${t}'\n  )`}(Z),n={where:r,outFields:[ce,de,"title_ru","title_uz_c","title_uz_l","allowed_users",...ue.localField?[ue.localField]:[]],returnGeometry:!0};(yield T.query(n,{widgetId:o.id})).records;const l=t.filter((e=>h(e,Z)));k(l)}catch(e){console.error("\u274c Search widget: Load failed:",e)}}));function xe(t){G(!1),oe.current&&clearTimeout(oe.current),F(t.localizedTitle),W(!1),P(-1),g(f.SELECTED_DAM,t.damName||null);const r=new e.StringSelectionChangeMessage(o.id,t.damName);r.str=t.damName,e.MessageManager.getInstance().publishMessage(r)}if((0,r.useEffect)((()=>{if(B)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e);function e(e){re.current&&!re.current.contains(e.target)&&W(!1)}}),[B]),(0,r.useEffect)((()=>{let e=S();const t=e=>{if("customTheme"===e.key){const e=S();le(e),ae((e=>e+1))}};window.addEventListener("storage",t);const r=setInterval((()=>{const t=S();t!==e&&(e=t,le(t),ae((e=>e+1)))}),300);return()=>{window.removeEventListener("storage",t),clearInterval(r)}}),[]),(0,r.useEffect)((()=>{const e=m(f.SELECTED_DAM);if(e&&j.length>0&&!J){const t=j.find((t=>t.damName===e));F(t?t.localizedTitle:e)}else e||J||F("")}),[j,J]),(0,r.useEffect)((()=>{const e=setInterval((()=>{const e=m(f.SELECTED_DAM);if(e&&j.length>0&&!J){const t=j.find((t=>t.damName===e));t&&t.localizedTitle!==R&&F(t.localizedTitle)}else e||!R||J||F("")}),200);return()=>clearInterval(e)}),[j,R,J]),(0,r.useEffect)((()=>{const e=m(f.SELECTED_DAM);if(e&&j.length>0&&!J){const t=j.find((t=>t.damName===e));t&&t.localizedTitle!==R&&F(t.localizedTitle)}}),[K,j,J]),(0,r.useEffect)((()=>{const e=m(f.SELECTED_DAM);if(e&&A.length>0&&!J){const t=A.find((t=>t.getFieldValue(ce)===e));if(t){const e=p(t,K);e!==R&&F(e)}}}),[K,A,ce,J]),X)return(0,e.jsx)("div",{ref:re,style:{width:"100%",height:"100%",position:"relative",background:null!==(l=x(ue.bgColor,ne))&&void 0!==l?l:"#fff",borderRadius:ue.borderRadius||"16px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",textAlign:"center",color:null!==(i=x(ue.textColor,ne))&&void 0!==i?i:"#181923",fontSize:ue.fontSize||"14px",border:`1.5px solid ${null!==(a=x(ue.borderColor,ne))&&void 0!==a?a:"#e5e7eb"}`}},(0,e.jsx)("div",null,(0,e.jsx)("p",{style:{margin:"0 0 8px 0",fontWeight:600}},"ru"===K?"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438...":"uz"===K?"Avtorizatsiya tekshirilmoqda...":"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u0442\u0435\u043a\u0448\u0438\u0440\u0438\u043b\u043c\u043e\u049b\u0434\u0430..."),(0,e.jsx)("small",{style:{opacity:.7}},"ru"===K?"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435":"uz"===K?"Iltimos kuting":"\u0418\u043b\u0442\u0438\u043c\u043e\u0441 \u043a\u0443\u0442\u0438\u043d\u0433")));if(!Z)return(0,e.jsx)("div",{ref:re,style:{width:"100%",height:"100%",position:"relative",background:null!==(s=x(ue.bgColor,ne))&&void 0!==s?s:"#fff",borderRadius:ue.borderRadius||"16px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",textAlign:"center",color:null!==(u=x(ue.textColor,ne))&&void 0!==u?u:"#181923",fontSize:ue.fontSize||"14px",border:`1.5px solid ${null!==(y=x(ue.borderColor,ne))&&void 0!==y?y:"#e5e7eb"}`}},(0,e.jsx)("div",null,(0,e.jsx)("p",{style:{margin:"0 0 8px 0",fontWeight:600}},"ru"===K?"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u043d":"uz"===K?"Foydalanuvchi avtorizatsiya qilinmagan":"\u0424\u043e\u0439\u0434\u0430\u043b\u0430\u043d\u0443\u0432\u0447\u0438 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u049b\u0438\u043b\u0438\u043d\u043c\u0430\u0433\u0430\u043d"),(0,e.jsx)("small",{style:{opacity:.7}},"ru"===K?"\u0412\u043e\u0439\u0434\u0438\u0442\u0435 \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430":"uz"===K?"Qidiruv uchun kiring":"\u049a\u0438\u0434\u0438\u0440\u0438\u0448 \u0443\u0447\u0443\u043d \u043a\u0438\u0440\u0438\u043d\u0433")));const ye=B&&N.length>0&&t.default.createPortal((0,e.jsx)("div",{style:{position:"fixed",left:V.left,top:V.top,width:V.width,background:null!==(C=x(ue.dropdownItemBgColor,ne))&&void 0!==C?C:"#fff",borderRadius:ue.borderRadius||"12px",zIndex:9999,marginTop:"8px",maxHeight:220,overflowY:"auto",overflowX:"hidden"},onMouseDown:e=>e.stopPropagation()},N.map(((t,r)=>{var o,n,l,i,a,s;const u=$===r,d=t.localizedTitle===R,f=u?null!==(o=x(ue.dropdownItemHoverTextColor,ne))&&void 0!==o?o:"#2264e5":d?null!==(n=x(ue.dropdownItemActiveTextColor,ne))&&void 0!==n?n:"#2264e5":null!==(l=x(ue.dropdownItemTextColor,ne))&&void 0!==l?l:"#181923",m=u?null!==(i=x(ue.dropdownItemHoverBgColor,ne))&&void 0!==i?i:"#F2F7FF":d?null!==(a=x(ue.dropdownItemActiveBgColor,ne))&&void 0!==a?a:"#F2F7FF":null!==(s=x(ue.dropdownItemBgColor,ne))&&void 0!==s?s:"#fff";return(0,e.jsx)("div",{key:t.damName,style:{display:"flex",alignItems:"center",textAlign:"left",cursor:"pointer",fontSize:ue.dropdownItemFontSize||"16px",padding:ue.dropdownItemPadding||"12px 16px",borderRadius:ue.dropdownItemBorderRadius||"8px",margin:"0 8px",fontWeight:400,background:m,color:f,border:"1.5px solid transparent",transition:"background 0.15s, color 0.15s, border 0.15s"},onMouseEnter:()=>P(r),onMouseDown:e=>e.stopPropagation(),onClick:()=>xe(t)},(0,e.jsx)(c,{size:20,style:{marginRight:10,color:we(u,d)}}),(0,e.jsx)("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},t.localizedTitle))}))),document.body);return(0,e.jsx)("div",{ref:re,style:{width:"100%",height:"100%",position:"relative",borderRadius:ue.borderRadius||"16px",display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"stretch"}},(0,e.jsx)(e.DataSourceComponent,{useDataSource:se,widgetId:o.id,onDataSourceCreated:e=>D(e)}),(0,e.jsx)("div",{ref:re,style:{width:"100%",display:"flex",alignItems:"center",border:`1.5px solid ${pe||R.trim().length>0?he(ue.activeBorderColor):he(me?ue.hoverBorderColor:ue.defaultBorderColor||ue.borderColor)}`,borderRadius:ue.borderRadius||"16px",background:null!==(b=x(ue.bgColor,ne))&&void 0!==b?b:"#fff",padding:ue.padding||"0 18px",position:"relative",boxSizing:"border-box",opacity:Z?1:.6},onMouseEnter:()=>ge(!0),onMouseLeave:()=>ge(!1),onFocus:()=>ve(!0),onBlur:()=>ve(!1),onClick:()=>{var e;return null===(e=te.current)||void 0===e?void 0:e.focus()}},(0,e.jsx)(c,{size:20,style:{marginRight:10,color:(()=>{var e;return null!==(e=x(R.trim().length>0?ue.activeIconColor:ue.iconColor,ne))&&void 0!==e?e:"#181923"})()}}),(0,e.jsx)("div",{style:{width:"100%",height:"100%"}},(0,e.jsx)("style",null,`\n              .custom-placeholder::placeholder {\n                color: ${null!==(_=x(ue.placeholderColor,ne))&&void 0!==_?_:"black"};\n                opacity: 1;\n              }\n            `),(0,e.jsx)("input",{ref:te,className:"custom-placeholder",style:{width:"100%",border:"none",outline:"none",background:"transparent",color:null!==(I=x(ue.textColor,ne))&&void 0!==I?I:"#181923",fontSize:ue.fontSize||"16px",fontWeight:ue.fontWeight||400,padding:"14px 0"},value:R,placeholder:fe,disabled:!Z,onChange:t=>{G(!0),oe.current&&clearTimeout(oe.current),F(t.target.value),t.target.value.trim()?W(!0):W(!1),t.target.value.trim()||function(){G(!1),oe.current&&clearTimeout(oe.current),F(""),g(f.SELECTED_DAM,null);const t=new e.StringSelectionChangeMessage(o.id,"");t.str="",e.MessageManager.getInstance().publishMessage(t)}(),oe.current=setTimeout((()=>{G(!1)}),500)},onFocus:function(){if(re.current){const e=re.current.getBoundingClientRect();Y({left:e.left,top:e.bottom+window.scrollY,width:e.width})}R.trim()&&N.length>0?W(!0):W(!1),P(-1)},onBlur:()=>setTimeout((()=>W(!1)),180),onKeyDown:function(e){B&&0!==N.length&&("ArrowDown"===e.key?(e.preventDefault(),P((e=>Math.min(e+1,N.length-1)))):"ArrowUp"===e.key?(e.preventDefault(),P((e=>Math.max(e-1,0)))):"Enter"===e.key?(e.preventDefault(),$>=0&&N[$]?xe(N[$]):1===N.length&&xe(N[0])):"Escape"===e.key&&W(!1))},autoComplete:"off"}))),ye)}function C(e){l.p=e}})(),i})())}}}));