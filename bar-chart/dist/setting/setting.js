System.register(["jimu-core","jimu-ui/advanced/data-source-selector","jimu-ui","jimu-ui/basic/color-picker"],(function(e,t){var a={},s={},o={},i={};return{setters:[function(e){a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.React=e.React,a.jsx=e.jsx},function(e){s.DataSourceSelector=e.DataSourceSelector},function(e){o.Button=e.Button,o.NumericInput=e.NumericInput,o.Select=e.Select,o.TextInput=e.TextInput},function(e){i.ColorPicker=e.ColorPicker}],execute:function(){e((()=>{var e={8891:e=>{"use strict";e.exports=a},726:e=>{"use strict";e.exports=o},338:e=>{"use strict";e.exports=s},1362:e=>{"use strict";e.exports=i}},t={};function r(a){var s=t[a];if(void 0!==s)return s.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var l={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(l),r.d(l,{__set_webpack_public_path__:()=>p,default:()=>u});var e=r(8891),t=r(338),a=r(726),s=r(1362);const o={background:"#28292d",borderRadius:12,padding:18,marginBottom:22,boxShadow:"0 1px 3px rgba(0,0,0,0.07)",border:"1px solid #23262f22"},i={display:"flex",flexDirection:"column",gap:4,marginBottom:14},n={fontWeight:500,fontSize:14,marginBottom:2,color:"#f3f3f3"};class u extends e.React.PureComponent{constructor(t){super(t),this.supportedTypes=(0,e.Immutable)([e.DataSourceTypes.FeatureLayer]),this.updateAvailableFields=()=>{var t;const a=null===(t=this.props.useDataSources)||void 0===t?void 0:t[0];if(!a)return void this.setState({availableFields:[]});const s=e.DataSourceManager.getInstance().getDataSource(a.dataSourceId),o=null==s?void 0:s.getSchema(),i=(null==o?void 0:o.fields)?Object.values(o.fields).map((e=>({name:e.jimuName||e.name,alias:e.alias||e.jimuName||e.name}))):[];this.setState({availableFields:i})},this.updateProp=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:Object.assign(Object.assign({},this.props.config),{[e]:t})})},this.onDataSourceChange=e=>{this.props.onSettingChange({id:this.props.id,useDataSources:e}),setTimeout(this.updateAvailableFields,200)},this.addBar=()=>{var e,t,a,s,o;const{availableFields:i}=this.state,r={field:(null===(e=i[0])||void 0===e?void 0:e.name)||"",color:"#299AFF",label_ru:"",label_uz:"",label_uzcryl:"",borderRadiusTopLeft:null!==(t=this.props.config.barBorderRadius)&&void 0!==t?t:18,borderRadiusTopRight:null!==(a=this.props.config.barBorderRadius)&&void 0!==a?a:18,borderRadiusBottomRight:null!==(s=this.props.config.barBorderRadius)&&void 0!==s?s:18,borderRadiusBottomLeft:null!==(o=this.props.config.barBorderRadius)&&void 0!==o?o:18},l=Array.isArray(this.props.config.bars)?[...this.props.config.bars,r]:[r];this.updateProp("bars",l)},this.updateBar=(e,t,a)=>{const s=Array.isArray(this.props.config.bars)?[...this.props.config.bars]:[];s[e]=Object.assign(Object.assign({},s[e]),{[t]:a}),this.updateProp("bars",s)},this.removeBar=e=>{const t=Array.isArray(this.props.config.bars)?[...this.props.config.bars]:[];t.splice(e,1),this.updateProp("bars",t)},this.state={availableFields:[]}}componentDidMount(){this.updateAvailableFields()}componentDidUpdate(e){e.useDataSources!==this.props.useDataSources&&this.updateAvailableFields()}render(){var r,l,u,p,d,c;const{config:x,useDataSources:j}=this.props,{availableFields:g}=this.state,v=Array.isArray(x.bars)?x.bars:[];return(0,e.jsx)("div",{style:{fontSize:14,color:"#fff",background:"#212126"}},(0,e.jsx)("div",{style:o},(0,e.jsx)("div",{style:i},(0,e.jsx)("span",{style:n},"Источник данных"),(0,e.jsx)(t.DataSourceSelector,{mustUseDataSource:!0,types:this.supportedTypes,useDataSources:j,onChange:this.onDataSourceChange,widgetId:this.props.id}))),(0,e.jsx)("div",{style:o},(0,e.jsx)("div",{style:i},(0,e.jsx)("span",{style:n},"Поле для фильтра дамбы"),(0,e.jsx)(a.Select,{value:x.damFilterField||(g.find((e=>"title"===e.name))?"title":(null===(r=g[0])||void 0===r?void 0:r.name)||""),onChange:e=>this.updateProp("damFilterField",e.target.value)},g.map((t=>(0,e.jsx)("option",{key:t.name,value:t.name},t.alias)))))),g.length>0&&(0,e.jsx)("div",{style:o},(0,e.jsx)("div",{style:Object.assign(Object.assign({},n),{fontSize:16,marginBottom:8})},"Бары диаграммы"),v.map(((t,o)=>{var r,l,u,p,d,c,j,v;return(0,e.jsx)("div",{key:o,style:Object.assign(Object.assign({},i),{border:"1px solid #292929",borderRadius:8,marginBottom:10,padding:10,background:"#262729"})},(0,e.jsx)("span",{style:Object.assign(Object.assign({},n),{fontSize:14,marginBottom:4})},"Бар ",o+1),(0,e.jsx)("div",{style:i},(0,e.jsx)("span",{style:n},"Поле данных"),(0,e.jsx)(a.Select,{value:t.field,onChange:e=>this.updateBar(o,"field",e.target.value)},g.map((t=>(0,e.jsx)("option",{key:t.name,value:t.name},t.alias))))),(0,e.jsx)("div",{style:i},(0,e.jsx)("span",{style:n},"Цвет бара"),(0,e.jsx)(s.ColorPicker,{color:t.color||"#299AFF",onChange:e=>this.updateBar(o,"color",e)})),(0,e.jsx)("div",{style:i},(0,e.jsx)("span",{style:n},"Лейбл (RU)"),(0,e.jsx)(a.TextInput,{value:t.label_ru||"",onChange:e=>this.updateBar(o,"label_ru",e.target.value)}),(0,e.jsx)("span",{style:n},"Лейбл (UZ)"),(0,e.jsx)(a.TextInput,{value:t.label_uz||"",onChange:e=>this.updateBar(o,"label_uz",e.target.value)}),(0,e.jsx)("span",{style:n},"Лейбл (UZCRYL)"),(0,e.jsx)(a.TextInput,{value:t.label_uzcryl||"",onChange:e=>this.updateBar(o,"label_uzcryl",e.target.value)}),(0,e.jsx)("span",{style:n},"Атрибут для лейбла"),(0,e.jsx)(a.Select,{value:t.attributeField||"",onChange:e=>this.updateBar(o,"attributeField",e.target.value)},(0,e.jsx)("option",{value:""},"—"),g.map((t=>(0,e.jsx)("option",{key:t.name,value:t.name},t.alias))))),(0,e.jsx)("div",{style:i},(0,e.jsx)("span",{style:n},"Скругление углов бара"),(0,e.jsx)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"}},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4}},(0,e.jsx)("span",{style:{fontSize:12,color:"#ccc"}},"Верхний левый"),(0,e.jsx)(a.NumericInput,{value:null!==(l=null!==(r=t.borderRadiusTopLeft)&&void 0!==r?r:x.barBorderRadius)&&void 0!==l?l:18,min:0,max:64,onChange:e=>this.updateBar(o,"borderRadiusTopLeft",e),style:{width:60}})),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4}},(0,e.jsx)("span",{style:{fontSize:12,color:"#ccc"}},"Верхний правый"),(0,e.jsx)(a.NumericInput,{value:null!==(p=null!==(u=t.borderRadiusTopRight)&&void 0!==u?u:x.barBorderRadius)&&void 0!==p?p:18,min:0,max:64,onChange:e=>this.updateBar(o,"borderRadiusTopRight",e),style:{width:60}})),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4}},(0,e.jsx)("span",{style:{fontSize:12,color:"#ccc"}},"Нижний правый"),(0,e.jsx)(a.NumericInput,{value:null!==(c=null!==(d=t.borderRadiusBottomRight)&&void 0!==d?d:x.barBorderRadius)&&void 0!==c?c:18,min:0,max:64,onChange:e=>this.updateBar(o,"borderRadiusBottomRight",e),style:{width:60}})),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4}},(0,e.jsx)("span",{style:{fontSize:12,color:"#ccc"}},"Нижний левый"),(0,e.jsx)(a.NumericInput,{value:null!==(v=null!==(j=t.borderRadiusBottomLeft)&&void 0!==j?j:x.barBorderRadius)&&void 0!==v?v:18,min:0,max:64,onChange:e=>this.updateBar(o,"borderRadiusBottomLeft",e),style:{width:60}})))),(0,e.jsx)(a.Button,{size:"sm",type:"tertiary",style:{marginTop:8,background:"#c33",color:"#fff"},onClick:()=>this.removeBar(o)},"Удалить бар"))})),(0,e.jsx)(a.Button,{onClick:this.addBar,style:{width:"100%",marginTop:10},size:"sm"},"+ Добавить бар")),(0,e.jsx)("div",{style:o},(0,e.jsx)("div",{style:i},(0,e.jsx)("span",{style:n},"Заголовок (RU)"),(0,e.jsx)(a.TextInput,{value:x.title_ru||"",onChange:e=>this.updateProp("title_ru",e.target.value)}),(0,e.jsx)("span",{style:n},"Заголовок (UZ)"),(0,e.jsx)(a.TextInput,{value:x.title_uz||"",onChange:e=>this.updateProp("title_uz",e.target.value)}),(0,e.jsx)("span",{style:n},"Заголовок (UZCRYL)"),(0,e.jsx)(a.TextInput,{value:x.title_uzcryl||"",onChange:e=>this.updateProp("title_uzcryl",e.target.value)})),(0,e.jsx)("div",{style:i},(0,e.jsx)("span",{style:n},"Атрибут для заголовка"),(0,e.jsx)(a.Select,{value:x.titleAttribute||"",onChange:e=>this.updateProp("titleAttribute",e.target.value)},(0,e.jsx)("option",{value:""},"—"),g.map((t=>(0,e.jsx)("option",{key:t.name,value:t.name},t.alias))))),(0,e.jsx)("div",{style:i},(0,e.jsx)("span",{style:n},"Размер заголовка"),(0,e.jsx)(a.NumericInput,{value:x.titleFontSize||17,min:10,max:36,onChange:e=>this.updateProp("titleFontSize",e)}))),(0,e.jsx)("div",{style:o},(0,e.jsx)("div",{style:Object.assign(Object.assign({},n),{fontSize:16,marginBottom:8})},"Цвета текста"),(0,e.jsx)("div",{style:i},(0,e.jsx)("span",{style:n},"Цвет процентов (светлая тема)"),(0,e.jsx)(s.ColorPicker,{color:x.percentTextColor||"#333",onChange:e=>this.updateProp("percentTextColor",e)}),(0,e.jsx)("span",{style:n},"Цвет процентов (тёмная тема)"),(0,e.jsx)(s.ColorPicker,{color:x.percentTextColorDark||"#fff",onChange:e=>this.updateProp("percentTextColorDark",e)})),(0,e.jsx)("div",{style:i},(0,e.jsx)("span",{style:n},"Цвет подписей баров (светлая тема)"),(0,e.jsx)(s.ColorPicker,{color:x.barLabelTextColor||"#333",onChange:e=>this.updateProp("barLabelTextColor",e)}),(0,e.jsx)("span",{style:n},"Цвет подписей баров (тёмная тема)"),(0,e.jsx)(s.ColorPicker,{color:x.barLabelTextColorDark||"#fff",onChange:e=>this.updateProp("barLabelTextColorDark",e)}))),(0,e.jsx)("div",{style:o},(0,e.jsx)("div",{style:Object.assign(Object.assign({},n),{fontSize:16,marginBottom:8})},"Цвет фона"),(0,e.jsx)("div",{style:i},(0,e.jsx)("span",{style:n},"Фон (светлая тема)"),(0,e.jsx)(s.ColorPicker,{color:x.bgColor||"#fff",onChange:e=>this.updateProp("bgColor",e)}),(0,e.jsx)("span",{style:n},"Фон (тёмная тема)"),(0,e.jsx)(s.ColorPicker,{color:x.bgColorDark||"#232324",onChange:e=>this.updateProp("bgColorDark",e)}))),(0,e.jsx)("div",{style:o},(0,e.jsx)("div",{style:Object.assign(Object.assign({},n),{fontSize:16,marginBottom:8})},"Скругление углов"),(0,e.jsx)("div",{style:i},(0,e.jsx)("span",{style:n},"Контейнер (px)"),(0,e.jsx)(a.NumericInput,{value:null!==(l=x.borderRadius)&&void 0!==l?l:16,min:0,max:64,onChange:e=>this.updateProp("borderRadius",e)}),(0,e.jsx)("span",{style:n},"Бары (px)"),(0,e.jsx)(a.NumericInput,{value:null!==(u=x.barBorderRadius)&&void 0!==u?u:18,min:0,max:64,onChange:e=>this.updateProp("barBorderRadius",e)}),(0,e.jsx)("span",{style:n},"Бары бордер (px)"),(0,e.jsx)(a.NumericInput,{value:null!==(p=x.barBorderWidth)&&void 0!==p?p:"0px",min:0,max:64,onChange:e=>this.updateProp("barBorderWidth",e)}),(0,e.jsx)("span",{style:n},"Бары бордер цвет"),(0,e.jsx)(s.ColorPicker,{color:null!==(d=x.barBorderColor)&&void 0!==d?d:"#fff",onChange:e=>this.updateProp("barBorderColor",e)}))),(0,e.jsx)("div",{style:o},(0,e.jsx)("div",{style:Object.assign(Object.assign({},n),{fontSize:16,marginBottom:8})},"Анимация и отступы"),(0,e.jsx)("div",{style:i},(0,e.jsx)("span",{style:n},"Отступ между барами (px)"),(0,e.jsx)(a.NumericInput,{value:null!==(c=x.barMargin)&&void 0!==c?c:10,min:0,max:40,onChange:e=>this.updateProp("barMargin",e)}),(0,e.jsx)("span",{style:n},"Анимация при наведении"),(0,e.jsx)(a.Select,{value:!1===x.enableBarAnimation?"off":"on",onChange:e=>this.updateProp("enableBarAnimation","on"===e.target.value)},(0,e.jsx)("option",{value:"on"},"Включена"),(0,e.jsx)("option",{value:"off"},"Отключена")))))}}function p(e){r.p=e}})(),l})())}}}));